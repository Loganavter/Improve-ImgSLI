# Maintainer: Boradorka
# Co-maintainer: Nebulosa

pkgname=improve-imgsli
pkgver=7.9.0
pkgrel=1
pkgdesc="Image comparison tool with magnifying glass feature"
arch=('x86_64')
url="https://github.com/Loganavter/Improve-ImgSLI"
license=('MIT')
depends=(
  'hicolor-icon-theme'
  'python'
  'python-darkdetect'
  'python-markdown'
  'python-numpy'
  'python-pillow'
  'python-pyqt6'
  'python-scikit-image'
  'python-wand'
)
optdepends=(
  'python-desktop-notifier: enhanced system notifications'
  'python-snakeviz: for performance profiling'
)
makedepends=(
  'python-build'
  'python-installer'
  'python-pip'
  'python-wheel'
)
options=(!debug)
source=("file:///home/jorj/Загрузки/improve-imgsli-7.9.0.tar.gz")

sha256sums=('SKIP')

prepare() {
  #Making launching app more secure
  sed -i "s|^Exec=$pkgname|Exec=/usr/bin/$pkgname|" "$srcdir"/Improve-ImgSLI-$pkgver/build/AUR-template/$pkgname.desktop
}

package() {
  cd "$srcdir/Improve-ImgSLI-$pkgver"

  # Install launcher, desktop file, icon, and license
  install -vDm 755 build/AUR-template/launcher.sh "$pkgdir/usr/bin/$pkgname"
  install -vDm 644 build/AUR-template/improve-imgsli.desktop "$pkgdir/usr/share/applications/$pkgname.desktop"
  install -vDm 644 src/resources/icons/icon.png "$pkgdir/usr/share/icons/hicolor/512x512/apps/$pkgname.png"
  install -vDm 644 LICENSE.txt "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

  # Install application source code and all resources from the src directory
  install -d "$pkgdir/usr/lib/$pkgname"
  cp -r src/* "$pkgdir/usr/lib/$pkgname/"

  # Clean up pycache if any got copied
  find "$pkgdir/usr/lib/$pkgname" -type d -name "__pycache__" -exec rm -rf {} +
}